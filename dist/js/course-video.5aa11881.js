(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["course-video"],{"1f26":function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"course-video"},[n("div",{staticClass:"page-header"},[n("el-page-header",{attrs:{content:"上传视频"},on:{back:e.goBack}})],1),n("el-card",{staticStyle:{"margin-top":"20px"}},[n("el-form",{attrs:{"label-width":"80px"}},[n("div",[n("el-form-item",{attrs:{label:"课程名称"}},[n("el-input",{attrs:{disabled:""},model:{value:e.course.courseName,callback:function(t){e.$set(e.course,"courseName",t)},expression:"course.courseName"}})],1),n("el-form-item",{attrs:{label:"课时"}},[n("el-input",{attrs:{disabled:""},model:{value:e.lesson.theme,callback:function(t){e.$set(e.lesson,"theme",t)},expression:"lesson.theme"}})],1)],1),n("el-form-item",{attrs:{label:"视频上传"}},[n("input",{ref:"video-file",attrs:{type:"file"}})]),n("el-form-item",{attrs:{label:"封面上传"}},[n("input",{ref:"image-file",attrs:{type:"file"}})]),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:e.handleUpload}},[e._v("开始上传")]),n("el-button",{on:{click:function(t){return e.$router.back()}}},[e._v("返回")])],1),n("el-form-item",[n("p",[e._v("视频上传中："+e._s(e.uploadPercent)+"%")]),e.isUploadSuccess?n("p",[e._v("视频转码中："+e._s(e.isTransCodeSuccess?"完成":"正在处理，请稍后"))]):e._e()])],1)],1)],1)},o=[],a=(n("b0c0"),n("96cf"),n("1da1")),s=n("2b0e"),u=n("b32d"),c=function(){return Object(u["a"])({method:"GET",url:"/boss/course/upload/aliyunImagUploadAddressAdnAuth.json"})},i=function(e){return Object(u["a"])({method:"GET",url:"/boss/course/upload/aliyunVideoUploadAddressAdnAuth.json",params:e})},l=function(e){return Object(u["a"])({method:"POST",url:"/boss/course/upload/aliyunTransCode.json",data:e})},d=function(e){return Object(u["a"])({method:"GET",url:"/boss/course/upload/aliyunTransCodePercent.json",params:{lessonId:e}})},p=n("6fd8"),f=n("49e4"),m=s["default"].extend({name:"CourseVideo",data:function(){return{course:[],lesson:[],uploader:null,imageURL:"",videoId:null,uploadPercent:0,isUploadSuccess:!1,isTransCodeSuccess:!1}},computed:{video:function(){return this.$refs["video-file"]},image:function(){return this.$refs["image-file"]}},created:function(){this.loadCourse(),this.loadLesson(),this.initUploader()},methods:{initUploader:function(){var e=this;this.uploader=new window.AliyunUpload.Vod({userId:"1618139964448548",region:"",partSize:1048576,parallel:5,retryCount:3,retryDuration:2,onUploadstarted:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(n){var r,o,a,s,u;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(console.log("onUploadstarted",n),!n.isImage){t.next=10;break}return t.next=4,c();case 4:o=t.sent,a=o.data,r=a.data,e.imageURL=a.data.imageURL,t.next=16;break;case 10:return t.next=12,i({fileName:n.file.name,imageUrl:e.imageURL});case 12:s=t.sent,u=s.data,r=u.data,e.videoId=r.videoId;case 16:e.uploader.setUploadAuthAndAddress(n,r.uploadAuth,r.uploadAddress,r.imageId||r.videoId);case 18:case"end":return t.stop()}}),t)})));function n(e){return t.apply(this,arguments)}return n}(),onUploadSucceed:function(e){console.log("onUploadSucceed",e)},onUploadFailed:function(e,t,n){console.log("onUploadFailed",e)},onUploadProgress:function(t,n,r){t.isImage||(e.uploadPercent=Math.floor(100*r))},onUploadTokenExpired:function(e){console.log("onUploadTokenExpired",e)},onUploadEnd:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(n){var r,o,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.isUploadSuccess=!0,t.next=3,l({lessonId:e.$route.query.lessonId,coverImageUrl:e.imageURL,fileName:e.video.files[0].name,fileId:e.videoId});case 3:r=t.sent,o=r.data,console.log("fsfsf",o),s=setInterval(Object(a["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,d(e.$route.query.lessonId);case 2:n=t.sent,r=n.data,console.log(r),100===r.data&&(e.isTransCodeSuccess=!0,window.clearInterval(s),console.log("转码成功"));case 6:case"end":return t.stop()}}),t)}))),3e3);case 7:case"end":return t.stop()}}),t)})));function n(e){return t.apply(this,arguments)}return n}()})},loadCourse:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(p["b"])(e.$route.params.courseId);case 2:n=t.sent,r=n.data,e.course=r.data;case 5:case"end":return t.stop()}}),t)})))()},loadLesson:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(f["a"])(e.$route.query.lessonId);case 2:n=t.sent,r=n.data,e.lesson=r.data;case 5:case"end":return t.stop()}}),t)})))()},handleUpload:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var n,r,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.isUploadSuccess=!1,e.isTransCodeSuccess=!1,e.uploadPercent=0,n=e.video.files[0],r=e.image.files[0],console.log(n,r),o=e.uploader,o.addFile(r,null,null,null,'{"Vod":{}}'),o.addFile(n,null,null,null,'{"Vod":{}}'),o.startUpload();case 10:case"end":return t.stop()}}),t)})))()},goBack:function(){this.$router.back()}}}),b=m,h=n("2877"),g=Object(h["a"])(b,r,o,!1,null,"9bb53a62",null);t["default"]=g.exports},"49e4":function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return a}));var r=n("b32d"),o=function(e){return Object(r["a"])({method:"GET",url:"/boss/course/lesson/getById",params:{lessonId:e}})},a=function(e){return Object(r["a"])({method:"POST",url:"/boss/course/lesson/saveOrUpdate",data:e})}},"6fd8":function(e,t,n){"use strict";n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return a})),n.d(t,"d",(function(){return s})),n.d(t,"e",(function(){return u})),n.d(t,"b",(function(){return c}));var r=n("b32d"),o=function(e){return Object(r["a"])({method:"POST",url:"/boss/course/getQueryCourses",data:e})},a=function(e){return Object(r["a"])({method:"GET",url:"/boss/course/changeState",params:e})},s=function(e){return Object(r["a"])({method:"POST",url:"/boss/course/saveOrUpdateCourse",data:e})},u=function(e,t){return Object(r["a"])({method:"POST",url:"/boss/course/upload",data:e,onUploadProgress:t})},c=function(e){return Object(r["a"])({method:"GET",url:"/boss/course/getCourseById",params:{courseId:e}})}},b0c0:function(e,t,n){var r=n("83ab"),o=n("9bf2").f,a=Function.prototype,s=a.toString,u=/^\s*function ([^ (]*)/,c="name";r&&!(c in a)&&o(a,c,{configurable:!0,get:function(){try{return s.call(this).match(u)[1]}catch(e){return""}}})}}]);
//# sourceMappingURL=course-video.5aa11881.js.map